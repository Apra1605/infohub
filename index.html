<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gemini Background Report Generator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f3f4f6;
      margin: 0;
      padding: 0;
      color: #111;
    }
    header {
      background: #1f2937;
      color: #fff;
      padding: 1rem 2rem;
      font-size: 1.5rem;
    }
    main {
      padding: 2rem;
      max-width: 900px;
      margin: auto;
    }
    .input-area {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }
    input[type="text"] {
      flex: 1;
      padding: 0.75rem;
      border: 1px solid #ccc;
      border-radius: 0.5rem;
      font-size: 1rem;
    }
    button {
      padding: 0.75rem 1.25rem;
      border: none;
      border-radius: 0.5rem;
      background: #2563eb;
      color: white;
      font-size: 1rem;
      cursor: pointer;
    }
    button:disabled {
      background: #9ca3af;
    }
    pre#output {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 0.5rem;
      padding: 1rem;
      white-space: pre-wrap;
      word-wrap: break-word;
      font-family: monospace;
      font-size: 0.9rem;
      max-height: 600px;
      overflow-y: auto;
    }
    .status {
      margin-top: 0.5rem;
      font-size: 0.9rem;
      color: #555;
    }
  </style>
</head>
<body>
  <header>Gemini Background Report Generator</header>
  <main>
    <div class="input-area">
      <input type="text" id="query" placeholder="Enter a name, topic, or query..." />
      <button id="generate">Generate</button>
    </div>
    <div class="status" id="status">Idle</div>
    <pre id="output"></pre>
  </main>

  <script>
    const GEMINI_API_KEY = "AIzaSyBELzK5j4T6kss4ZQSz4OLB7OLX-Bo_WO4"; // Replace with your key locally
    const GEMINI_MODEL = "gemini-2.0-flash";

    const statusEl = document.getElementById('status');
    const outputEl = document.getElementById('output');

    function setStatus(msg) {
      statusEl.textContent = msg;
    }

    function buildPrompt(query) {
      return `You are an expert report generator. The user query is: "${query}".
Return a single complete HTML5 document (with <!DOCTYPE html>, <html>, <head>, and <body> tags) styled like a professional police background search report. Use clean CSS inside <style>.
Organize the information into structured boxes, tables, and sections (e.g. Profile, History, Records, Media, References). Use placeholder images if none are available. Do not add explanations outside the HTML.`;
    }

    function getFirstText(data) {
      try {
        return data.candidates?.[0]?.content?.parts?.[0]?.text || null;
      } catch (e) {
        console.error('Error extracting text:', e, data);
        return null;
      }
    }

    function stripCodeFences(text) {
      return text.replace(/```(html)?/gi, '').trim();
    }

    document.getElementById('generate').addEventListener('click', async () => {
      const q = document.getElementById('query').value.trim();
      if (!q) return alert('Enter a query first');
      if (!GEMINI_API_KEY) return alert('Please add your API key into the code');

      setStatus('Sending request...');
      outputEl.textContent = '';
      try {
        const body = {
          contents: [{ role: 'user', parts: [{ text: buildPrompt(q) }] }],
          generationConfig: { maxOutputTokens: 7000 }
        };

        const res = await fetch(
          `https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL}:generateContent?key=${encodeURIComponent(GEMINI_API_KEY)}`,
          {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(body)
          }
        );

        if (!res.ok) {
          const errText = await res.text();
          throw new Error(`HTTP ${res.status} ${res.statusText}: ${errText}`);
        }

        const data = await res.json();
        console.log('Raw response:', data);
        const text = getFirstText(data);
        if (!text) throw new Error('Empty response from Gemini');

        const htmlRaw = stripCodeFences(text);
        outputEl.textContent = htmlRaw;
        setStatus('Done');
      } catch (err) {
        console.error('Error during generation:', err);
        outputEl.textContent = 'Error: ' + (err?.message || err);
        setStatus('Error');
      }
    });
  </script>
</body>
</html>
